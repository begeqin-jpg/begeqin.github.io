<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Donate with PayPal</title>
  <style>
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#f6f7fb;
      color:#111;
    }
    .card{
      width:min(420px, 92vw);
      background:#fff;
      border:1px solid #e8e8ef;
      border-radius:16px;
      padding:20px;
      box-shadow:0 8px 30px rgba(0,0,0,.08);
    }
    h2{ margin:0 0 10px; font-size:20px; }
    p{ margin:0 0 16px; color:#555; font-size:14px; }
    label{ display:block; font-size:13px; margin:0 0 6px; color:#333; }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:14px;
    }
    input{
      width:100%;
      padding:12px 12px;
      border:1px solid #d9d9e3;
      border-radius:10px;
      font-size:16px;
      outline:none;
    }
    input:focus{ border-color:#4c7dff; box-shadow:0 0 0 3px rgba(76,125,255,.15); }
    .hint{ font-size:12px; color:#666; margin-top:-6px; margin-bottom:14px; }
    .error{ color:#b00020; font-size:12px; margin:10px 0 0; display:none; }
    .success{ color:#0b6b0b; font-size:12px; margin:10px 0 0; display:none; }
    #paypal-button-container{ margin-top:10px; }
    .small{ font-size:12px; color:#777; margin-top:10px; line-height:1.35; }
  </style>
</head>
<body>

  <div class="card">
    <h2>Поддержать через PayPal</h2>
    <p>Введите сумму и нажмите кнопку PayPal.</p>

    <label for="amount">Сумма (USD)</label>
    <div class="row">
      <input id="amount" type="number" inputmode="decimal" min="1" step="0.01" placeholder="Например: 10.00" />
    </div>
    <div class="hint">Минимум $1.00. Можно вводить с копейками (например 5.50).</div>

    <div id="paypal-button-container"></div>

    <div id="err" class="error">Введите корректную сумму (минимум 1.00).</div>
    <div id="ok" class="success">Платёж успешно завершён.</div>

    <div class="small">
      Если у человека есть возможность “Debit or Credit Card / Pay as guest”, PayPal может показать экран с выбором карт.
      Но PayPal сам решает какой экран показывать.
    </div>
  </div>

  <!-- PayPal JS SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAAckpuoQtuQv2bX_6xePLrMM-4eAISQLU61urj-19yqBSYaBLnNNDNxiF_3f2kTCWiDyNDuI98KRRSZXY&currency=USD&intent=capture"></script>

  <script>
    const amountInput = document.getElementById('amount');
    const err = document.getElementById('err');
    const ok = document.getElementById('ok');

    function getAmount() {
      const v = parseFloat(String(amountInput.value).replace(',', '.'));
      if (!isFinite(v)) return null;
      // округлим до 2 знаков
      const rounded = Math.round(v * 100) / 100;
      if (rounded < 1) return null;
      return rounded.toFixed(2);
    }

    paypal.Buttons({
      style: {
        layout: 'vertical',
        label: 'paypal'
      },

      onClick: function() {
        ok.style.display = 'none';
        const a = getAmount();
        if (!a) {
          err.style.display = 'block';
          // Отменяем клик (кнопка не продолжит)
          return false;
        }
        err.style.display = 'none';
        return true;
      },

      createOrder: function(data, actions) {
        const a = getAmount();
        if (!a) {
          err.style.display = 'block';
          return;
        }
        return actions.order.create({
          purchase_units: [{
            amount: { value: a },
            description: "Donation"
          }]
        });
      },

      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          ok.style.display = 'block';
          alert('Payment completed. Thank you!');
        });
      },

      onError: function(e) {
        console.error(e);
        err.textContent = "Ошибка PayPal. Попробуйте ещё раз или другой браузер.";
        err.style.display = 'block';
      }
    }).render('#paypal-button-container');
  </script>

</body>
</html>
